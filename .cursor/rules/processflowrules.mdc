---
description: Code Norms you must respect
globs: 
alwaysApply: true
---
# Code Norms üöÄ

## **1. Naming & Function Size**

### ‚úÖ **Mandatory**

- **Function Size**: Keep functions small and focused (max **50 lines**, ideally **20-30**).
- **Single Responsibility**: Each function should do **one thing well**.
- **Parameter Handling**: If a function has **too many parameters**, refactor it to use an **object**.
- **Naming Conventions**:
    - **camelCase** for variables & functions (`fetchData`).
    - **PascalCase** for components (`UserCard`).
    - **kebab-case** for filenames (`user-card.tsx`).
    - **Descriptive names** (`handleUserLogin`, not `doStuff`).
- **Prisma Schema**: Use **snake_case** for fields and model names.

### üü° **Recommended**

- **Utility Functions**: Extract reusable logic into **separate utility functions**.
- **Event Handlers**: Use `handleSomething` (`handleClick`).

---

## **2. JSX & HTML Formatting**

### ‚úÖ **Mandatory**

- **Self-close components without children**:
    
    ```tsx
    tsx
    CopierModifier
    <Input value="text" /> ‚úÖ
    <Input value="text"></Input> ‚ùå
    
    ```
    
- **Use parentheses for multi-line JSX**:
    
    ```tsx
    tsx
    CopierModifier
    return (
      <div>
        <Header />
        <Main />
      </div>
    );
    
    ```
    
- **Semantic HTML**:
    - Use `<button>`, `<article>`, `<section>` instead of `<div>`.
    - Avoid `<div>` unless necessary.
    - Forms should always have a **label** for accessibility.

### üü° **Recommended**

- Prefer `<section>` over `<div>` for layout grouping.
- **Destructure props** in components:
    
    ```tsx
    tsx
    CopierModifier
    function UserCard({ name, age }: { name: string; age: number }) ‚úÖ
    function UserCard(props: { name: string; age: number }) ‚ùå
    
    ```
    

---

## **3. API Calls & Data Fetching**

### ‚úÖ **Mandatory**

- **Use async/await** for readability:
    
    ```
    ts
    CopierModifier
    const data = await fetchData();
    
    ```
    
- **Client-side fetching**: Use **React Query (TanStack) or SWR**.
- **Server-side fetching**:
    - Use **Server Actions** (preferred) or `getServerSideProps` if needed.
    - Place API routes inside `/app/api/` instead of `pages/api/`.
- **Security**:
    - **Sanitize user input** before sending it to APIs.
    - **Escape values** before inserting into JSX:
        
        ```tsx
        tsx
        CopierModifier
        <div>{sanitize(userInput)}</div> ‚úÖ
        
        ```
        

### üü° **Recommended**

- Use **Zod/Yup** for request validation before sending data to APIs.

---

## **4. Error Handling**

### ‚úÖ **Mandatory**

- **Always handle errors gracefully**:
    
    ```
    ts
    CopierModifier
    try {
      const user = await getUser();
    } catch (error) {
      console.error("Failed to fetch user", error);
    }
    
    ```
    
- **Never expose sensitive errors** to the frontend.
- **Use logging tools** like Sentry for production errors.

### üü° **Recommended**

- **Use custom error classes** for detailed error handling.

---

## **5. Security Best Practices**

### ‚úÖ **Mandatory**

- **Secrets**: Store in `.env` files **only**, never in the codebase.
- **Escape user input** before inserting into a database/API.
- **Use Next.js Middleware (`middleware.ts`)** to protect API routes.
- **Prevent SQL injections** by validating all Prisma input.
- **Use soft deletes** instead of `deleteMany()`:Query only active users:
    
    ```
    prisma
    CopierModifier
    model User {
      id        String  @id @default(uuid())
      name      String
      archived_at              DateTime?
    }
    
    ```
    
    ```
    ts
    CopierModifier
    const users = await prisma.user.findMany({
      where: { archived_at: null },
    });
    
    ```
    

### üü° **Recommended**

- **Use Helmet.js** for extra HTTP security headers.
- **Use database connection pooling** (e.g., PgBouncer for PostgreSQL).

---

## **6. File Structure & Organization**

### ‚úÖ **Mandatory**

```
bash
CopierModifier
/components  ‚Üí Reusable UI components
/hooks       ‚Üí Custom React hooks
/lib         ‚Üí Utility functions (e.g., API clients, helpers)
/app         ‚Üí Next.js app router
/prisma      ‚Üí Prisma schema & migrations
/public      ‚Üí Static assets

```

- **Component files** should match the component name (`Button.tsx`, `Modal.tsx`).

### üü° **Recommended**

- Consider grouping API handlers in `/api` instead of inside `pages/api`.

---

## **7. Prisma & Database Best Practices**

### ‚úÖ **Mandatory**

- **Query Optimization**: Select only necessary fields:
    
    ```
    ts
    CopierModifier
    const users = await prisma.user.findMany({
      select: { id: true, name: true, email: true },
    });
    
    ```
    
- **Use transactions** when multiple queries depend on each other:
    
    ```
    ts
    CopierModifier
    await prisma.$transaction([
      prisma.user.update({ where: { id: 1 }, data: { balance: { decrement: 50 } } }),
      prisma.payment.create({ data: { userId: 1, amount: 50 } }),
    ]);
    
    ```
    
- **Always run migrations via Prisma** (`prisma migrate dev`).
- **Keep `prisma/schema.prisma` clean and well-commented**.

### üü° **Recommended**

- **Use Prisma logging** for debugging performance issues:
    
    ```
    ts
    CopierModifier
    const prisma = new PrismaClient({ log: ["query", "info", "warn", "error"] });
    
    ```
    
- **Use clear migration messages** (`add_user_role_enum`).

---

## **8. Next.js 15 & App Router Specific Rules**

### ‚úÖ **Mandatory**

- **Use Server Components by default**:
    
    ```tsx
    tsx
    CopierModifier
    async function Component() { ... }
    
    ```
    
- **Use `use client` only when necessary**.
- **Use Next.js Middleware (`middleware.ts`)** for request handling.
- **Use `useFormState`** instead of `useState` for form handling in Server Components.

### üü° **Recommended**

- Use `generateMetadata()` instead of `<Head>`.
- Use `suspense` and `loading.tsx` for loading states.
- Use `server-only` to enforce server-side execution of utility functions.